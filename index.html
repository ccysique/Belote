<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion de Tournoi de Belote</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            max-width: 900px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1, h2 {
            color: #2c3e50;
        }
        .form-group {
            margin-bottom: 15px;
        }
        input[type="text"], input[type="number"], textarea, button, select {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        button.secondary {
            background-color: #95a5a6;
        }
        button.secondary:hover {
            background-color: #7f8c8d;
        }
        button:hover {
            background-color: #2980b9;
        }
        .teams-list, .matches-list, .scoreboard {
            margin-top: 20px;
        }
        .team-card {
            background: #ecf0f1;
            padding: 10px;
            margin-bottom: 5px;
            border-radius: 4px;
        }
        .match-card {
            background: #eaf1f6;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .match-card .score-input {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .match-card .score-input label {
            flex: 1;
            text-align: right;
            white-space: nowrap;
        }
        .match-card .score-input input {
            flex: 1;
            width: auto;
            margin: 0;
        }
        .match-card button {
            width: auto;
            align-self: flex-end;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            text-align: left;
            padding: 8px;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f2f2f2;
        }
        .hidden {
            display: none;
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            .match-card .score-input {
                flex-direction: column;
                align-items: stretch;
            }
            .match-card .score-input label {
                text-align: left;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Gestion de Tournoi de Belote</h1>
    
    <section id="test-mode">
        <h2>Mode Test Rapide</h2>
        <div class="form-group">
            <label for="testNumTeams">Nombre d'équipes à générer :</label>
            <input type="number" id="testNumTeams" min="2" value="4">
        </div>
        <div class="form-group">
            <label for="testNumRounds">Nombre de tours :</label>
            <input type="number" id="testNumRounds" min="1" value="3">
        </div>
        <button onclick="runTestMode()">Lancer un tournoi test</button>
    </section>

    <hr>

    <section id="setup">
        <h2>1. Inscription des équipes (Manuel)</h2>
        <div class="form-group">
            <label for="teamsManual">Entrez les équipes manuellement (une équipe par ligne, joueurs séparés par une virgule) :</label>
            <textarea id="teamsManual" rows="4" placeholder="Équipe 1, Joueur A, Joueur B&#10;Équipe 2, Joueur C, Joueur D"></textarea>
            <button onclick="addManualTeams()">Ajouter les équipes</button>
        </div>
        <hr>
        <div class="form-group">
            <label for="participantsList">Ou générez des équipes à partir d'une liste de participants (un nom par ligne) :</label>
            <textarea id="participantsList" rows="4" placeholder="Joueur 1&#10;Joueur 2&#10;Joueur 3&#10;Joueur 4"></textarea>
            <button onclick="generateRandomTeams()">Générer des équipes aléatoirement</button>
        </div>
    </section>
    
    <section id="teams-display" class="hidden">
        <h2>2. Liste des équipes</h2>
        <div class="teams-list" id="teamsList"></div>
        <div class="form-group">
            <label for="numRounds">Nombre de tours à jouer :</label>
            <input type="number" id="numRounds" min="1" value="1">
            <button onclick="startTournament()">Lancer le tournoi</button>
        </div>
    </section>

    <section id="tournament-rounds" class="hidden">
        <h2>3. Matchs par tour</h2>
        <div id="roundsContainer"></div>
        <button onclick="showScoreboard()" id="showScoreboardButton">Afficher le classement final</button>
    </section>

    <section id="scoreboard-section" class="hidden">
        <h2>4. Classement</h2>
        <div class="scoreboard" id="scoreboard"></div>
        <button onclick="resetApp()" class="secondary">Recommencer un tournoi</button>
    </section>
</div>

<script>
    let teams = [];
    let rounds = [];
    let numRounds = 1;

    function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function hideAllSections() {
        document.getElementById('setup').classList.add('hidden');
        document.getElementById('teams-display').classList.add('hidden');
        document.getElementById('tournament-rounds').classList.add('hidden');
        document.getElementById('scoreboard-section').classList.add('hidden');
        document.getElementById('test-mode').classList.add('hidden');
    }

    function resetApp() {
        teams = [];
        rounds = [];
        numRounds = 1;
        document.getElementById('test-mode').classList.remove('hidden');
        document.getElementById('setup').classList.remove('hidden');
        document.getElementById('teamsManual').value = '';
        document.getElementById('participantsList').value = '';
    }

    function runTestMode() {
        const numTeams = parseInt(document.getElementById('testNumTeams').value);
        const testNumRounds = parseInt(document.getElementById('testNumRounds').value);

        if (numTeams < 2 || numTeams % 2 !== 0) {
            alert("Veuillez entrer un nombre pair d'équipes (minimum 2).");
            return;
        }

        if (testNumRounds < 1) {
            alert("Le nombre de tours doit être d'au moins 1.");
            return;
        }

        const participantNames = "Alice,Bob,Charlie,David,Eve,Frank,Grace,Heidi,Ivan,Judy,Karen,Liam,Mike,Nora,Oscar,Pamela,Quentin,Rose,Steve,Tina,Ulysse,Vivian,Walter,Xavier,Yara,Zack".split(',');
        const testParticipants = [];
        for(let i = 0; i < numTeams * 2; i++) {
            testParticipants.push(participantNames[i % participantNames.length] + (Math.floor(i / participantNames.length) + 1));
        }
        
        shuffle(testParticipants);
        teams = [];
        for (let i = 0; i < testParticipants.length; i += 2) {
            teams.push({
                name: `Équipe Test ${teams.length + 1}`,
                players: [testParticipants[i], testParticipants[i + 1]],
                victories: 0,
                score: 0
            });
        }

        numRounds = testNumRounds;
        hideAllSections();
        document.getElementById('tournament-rounds').classList.remove('hidden');
        generateRounds();
        
        rounds.forEach(round => {
            round.forEach(match => {
                match.score1 = Math.floor(Math.random() * 200) + 50;
                match.score2 = Math.floor(Math.random() * 200) + 50;
                match.played = true;
            });
        });
        
        displayRounds();
    }

    function generateRandomTeams() {
        const participantsList = document.getElementById('participantsList').value;
        const participants = participantsList.split('\n').filter(p => p.trim() !== '');

        if (participants.length < 4 || participants.length % 2 !== 0) {
            alert("Veuillez entrer un nombre pair de participants (minimum 4).");
            return;
        }

        shuffle(participants);
        teams = [];
        for (let i = 0; i < participants.length; i += 2) {
            teams.push({
                name: `Équipe ${teams.length + 1}`,
                players: [participants[i], participants[i + 1]],
                victories: 0,
                score: 0
            });
        }
        hideAllSections();
        displayTeams();
    }

    function addManualTeams() {
        const teamsManual = document.getElementById('teamsManual').value;
        const teamsInput = teamsManual.split('\n').filter(l => l.trim() !== '');
        
        if (teamsInput.length < 2) {
            alert("Veuillez entrer au moins deux équipes.");
            return;
        }
        
        teams = teamsInput.map(line => {
            const parts = line.split(',').map(p => p.trim());
            return {
                name: parts[0],
                players: parts.slice(1),
                victories: 0,
                score: 0
            };
        });
        hideAllSections();
        displayTeams();
    }

    function displayTeams() {
        document.getElementById('teams-display').classList.remove('hidden');
        const teamsListDiv = document.getElementById('teamsList');
        teamsListDiv.innerHTML = '';
        teams.forEach(team => {
            const card = document.createElement('div');
            card.className = 'team-card';
            card.innerHTML = `<strong>${team.name}</strong>: ${team.players.join(', ')}`;
            teamsListDiv.appendChild(card);
        });
    }

    function startTournament() {
        numRounds = parseInt(document.getElementById('numRounds').value);
        if (isNaN(numRounds) || numRounds < 1) {
            alert("Le nombre de tours doit être d'au moins 1.");
            return;
        }
        
        hideAllSections();
        document.getElementById('tournament-rounds').classList.remove('hidden');
        generateRounds();
        displayRounds();
    }

    function generateRounds() {
        rounds = [];
        const allTeams = [...teams];
        
        const opponentsPlayed = new Map();
        teams.forEach(team => opponentsPlayed.set(team.name, new Set()));

        for (let r = 0; r < numRounds; r++) {
            const currentRound = [];
            let availableTeams = [...allTeams];
            shuffle(availableTeams);

            while (availableTeams.length > 0) {
                const team1 = availableTeams.shift();
                let team2 = null;

                for (let i = 0; i < availableTeams.length; i++) {
                    const candidate = availableTeams[i];
                    if (!opponentsPlayed.get(team1.name).has(candidate.name) && !opponentsPlayed.get(candidate.name).has(team1.name)) {
                        team2 = candidate;
                        availableTeams.splice(i, 1);
                        break;
                    }
                }

                if (!team2 && availableTeams.length > 0) {
                    team2 = availableTeams.shift();
                }

                if (team2) {
                    currentRound.push({ team1, team2, score1: 0, score2: 0, played: false });
                    opponentsPlayed.get(team1.name).add(team2.name);
                    opponentsPlayed.get(team2.name).add(team1.name);
                }
            }
            rounds.push(currentRound);
        }
    }

    function displayRounds() {
        const roundsContainer = document.getElementById('roundsContainer');
        roundsContainer.innerHTML = '';
        rounds.forEach((round, index) => {
            const roundDiv = document.createElement('div');
            roundDiv.innerHTML = `<h3>Tour ${index + 1}</h3>`;
            round.forEach((match, matchIndex) => {
                const matchCard = document.createElement('div');
                matchCard.className = 'match-card';
                matchCard.innerHTML = `
                    <p><strong>Match ${matchIndex + 1}:</strong> ${match.team1.name} vs ${match.team2.name}</p>
                    <div class="score-input">
                        <label>${match.team1.name} :</label>
                        <input type="number" min="0" value="${match.score1}" id="score-${index}-${matchIndex}-1">
                    </div>
                    <div class="score-input">
                        <label>${match.team2.name} :</label>
                        <input type="number" min="0" value="${match.score2}" id="score-${index}-${matchIndex}-2">
                    </div>
                    <button onclick="submitScores(${index}, ${matchIndex})">Valider les scores</button>
                `;
                roundDiv.appendChild(matchCard);
            });
            roundsContainer.appendChild(roundDiv);
        });
    }

    function submitScores(roundIndex, matchIndex) {
        const score1 = parseInt(document.getElementById(`score-${roundIndex}-${matchIndex}-1`).value);
        const score2 = parseInt(document.getElementById(`score-${roundIndex}-${matchIndex}-2`).value);
        
        if (isNaN(score1) || isNaN(score2)) {
            alert("Veuillez entrer des scores valides.");
            return;
        }

        const match = rounds[roundIndex][matchIndex];
        match.score1 = score1;
        match.score2 = score2;
        match.played = true;
    }

    function showScoreboard() {
        updateScoreboard();
        hideAllSections();
        document.getElementById('scoreboard-section').classList.remove('hidden');
        
        teams.sort((a, b) => {
            if (b.victories !== a.victories) {
                return b.victories - a.victories;
            }
            return b.score - a.score;
        });

        const scoreboardDiv = document.getElementById('scoreboard');
        scoreboardDiv.innerHTML = `
            <table>
                <thead>
                    <tr>
                        <th>Classement</th>
                        <th>Équipe</th>
                        <th>Victoires</th>
                        <th>Total Points</th>
                    </tr>
                </thead>
                <tbody id="scoreboardBody"></tbody>
            </table>
        `;
        const scoreboardBody = document.getElementById('scoreboardBody');
        teams.forEach((team, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${index + 1}</td>
                <td><strong>${team.name}</strong> (${team.players.join(', ')})</td>
                <td>${team.victories}</td>
                <td>${team.score}</td>
            `;
            scoreboardBody.appendChild(row);
        });
    }
    
    function updateScoreboard() {
        teams.forEach(team => {
            team.victories = 0;
            team.score = 0;
        });

        rounds.forEach(round => {
            round.forEach(match => {
                if (match.played) {
                    match.team1.score += match.score1;
                    match.team2.score += match.score2;
                    if (match.score1 > match.score2) {
                        match.team1.victories += 1;
                    } else if (match.score2 > match.score1) {
                        match.team2.victories += 1;
                    }
                }
            });
        });
    }

</script>

</body>
</html>
